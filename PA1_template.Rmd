---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---


## Loading and preprocessing the data
```{r}
# load csv data and transform the date variable to date object if needed
if(!exists('activity') || !is.data.frame(get('activity'))) {
  if(!file.exists("activity.csv")) unzip("activity.zip")
  activity <- read.csv("activity.csv")
  activity$date <- as.Date(activity$date)
}
```


## What is mean total number of steps taken per day?
```{r}
totalPerDay <- tapply(activity$steps, activity$date, sum, na.rm = TRUE)
barplot(totalPerDay,
        names.arg = format(as.Date(names(totalPerDay)), "%m-%d"),
        xlab = "Date", ylab = "Total Steps Per Day"
        )
stepsMean <- mean(totalPerDay)
stepsMedian <- median(totalPerDay)
```
The mean of total number of steps taken per day is `r round(stepsMean, 2)` steps.  
The median of total number of steps taken per day is `r stepsMedian` steps.

## What is the average daily activity pattern?
```{r}
stepsMeanInInterval <-
  tapply(activity$steps, activity$interval, mean, na.rm = T)
plot(names(stepsMeanInInterval), stepsMeanInInterval, type = "l",
     xlab = "Interval", ylab = "Mean Number of Steps")
maximum <- max(stepsMeanInInterval)
maxInterval <- which(stepsMeanInInterval == maximum)
```
The 5-minute interval that contains the maximum number of steps
on average is the `r names(maxInterval)` interval which contains
`r round(maximum, 2)` steps on average.

## Imputing missing values
```{r}
naCount <- sum(is.na(activity$steps))
missingRows <- which(is.na(activity$steps))
missingIntervals <- activity[missingRows, "interval"]
missingMeans <- stepsMeanInInterval[as.character(missingIntervals)]
activityComplete <- activity
activityComplete[missingRows, "steps"] <- missingMeans
totalPerDayComplete <- with(activityComplete,
                            tapply(steps, date, sum, na.rm = TRUE)
                            )
barplot(totalPerDayComplete,
        names.arg = format(as.Date(names(totalPerDayComplete)), "%m-%d"),
        xlab = "Date", ylab = "Total Steps Per Day"
        )
stepsMeanComplete <- mean(totalPerDayComplete)
stepsMedianComplete <- median(totalPerDayComplete)
```

There are `r naCount` missing values in the dataset.  
Missing values have been filled in by the mean number of steps in each interval.  
The mean of total number of steps taken per day is
now `r format(round(stepsMeanComplete, 2), scientific = F)` steps.  
The median of total number of steps taken per day is
now `r format(round(stepsMeanComplete, 2), scientific = F)` steps.  
Both the mean and the median number of steps taken per day has increased after
imputing the missing values.

## Are there differences in activity patterns between weekdays and weekends?
```{r message = FALSE}
library(dplyr)
library(ggplot2)

activityComplete$day.type <- factor(
  weekdays(activityComplete$date) %in% c("Saturday", "Sunday"),
  labels = c("weekday", "weekend")
  )

panelPlotData <- activityComplete %>%
  group_by(interval, day.type) %>%
  summarize(steps = mean(steps))

ggplot(panelPlotData, aes(interval, steps)) +
  geom_line() +
  facet_grid(day.type ~ .) +
  labs(x = "Interval", y = "Mean Number of Steps")
```
